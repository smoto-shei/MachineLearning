# この記事の目次

1. 機械学習とは
2. 機械学習プロジェクトの概要
   1. 機械学習プロジェクトとは
   2. システム開発プロジェクトとの違い
   3. PDCA サイクルでの仮説検証
   4. PDCA サイクルはいつ終わるのか
   5. 機械学習プロジェクトの全体像
3. 事前学習フェーズの深掘り
   1. 事前検証フェーズの目的
   2. 事前検証フェーズの作業前に確認すること
   3. 事前検証フェーズでプログラマーに必要となる心がけ
   4. プログラム開発から実行までの手順
      1. 学習プログラムに入力するデータを取得し、前処理する
      2. 学習プログラムと予測プログラムを作成する
      3. 精度検証用にデータを分割する
      4. プログラムを実行する

# 1. 機械学習とは

- データの集合から法則性を学ぶ技術

  ## 機械学習を使うために必要な２つのステップ

  1. ### 学習(fit):学習データからデータパターンを予測する
  2. ### 予測(predict):学習した結果を用いて、未知のデータを予測する
     - 学習と予測はタイミングや頻度が異なるため、別々のプログラムに分けることが一般的。
     - 学習プログラムは学習データ（機械学習に入力する大量のデータ群）を用いてパターンを学習し、学習済みモデルを作成する
     - 予測プログラムは学習済みモデルを使用して未知のデータを予測した結果を出力する

  ## 機械学習の目標

  1.  ### 精度の高い学習済みモデルを作ること
      - モデルの制度は選択する「機械学習モデル」と「前処理」の影響を受ける - 機械学習モデルは「学習する」という概念を数式で表したもの - 前処理は学習させるためにデータを整形する処理
      - **どの機械学習モデルが適しているか、どのような前処理が必要であるかは試行錯誤を繰り返すしかない。**

# 2. 機械学習プロジェクトの概要

1. ## 機械学習プロジェクトとは

   - 機械学習を利用したシステムを開発するために、調査、検証、実装を行うプロジェクト
   - 開発事例として次のようなものがあげられる
     - レコメンド：過去に購入した商品からオススメの商品を推奨
     - 売上予測：日付、気温など様々な情報から商品がどの程度売れそうか予測
     - 異常検知：期待される状態と異なるイベントを識別する

2. ## システム開発プロジェクトとの違い

   - システム開発
     - 要件定義で仕様を決め、使用する技術や選定してからプロジェクトを実装する
   - 機械学習プロジェクト
     - 技術をすぐに選定することができない。そもそも目的を達成
     - そもそも目的を達成できるかどうか試さないとわからない
     - **システムの仕様を決めるよりも前に、精度の高い学習済みモデルを得られるかどうかの検証が優先される。**

3. ## PDCA サイクルでの仮説検証

   - 精度の高い学習済みモデルを作るためには PDCA サイクルで仮説検証を繰り返すことが有効

     - P:仮説を立てる
     - D:プログラムを開発し実行する
     - C:実行結果を分析する
     - A:次のアクションを判断する

   - P:仮説を立てる
     - 検証結果の良し悪しが明確に測れる仮説を立てる
       例）売上を予測するプロジェクト
       _・過去の売上データ XXX と機械学習モデル YYY を使えば売上を予測可。_
     - 機械学習の専門知識や、導入対象となる業務の知識が必要。
   - D:プログラムを開発し実行する
     - 仮説を確認するためのプログラムを作る
       - 前処理：学習に使用するデータを機械学習に適した形式に整形する
       - 実装：学習プログラムと予測プログラムを実装する
       - 実行：学習プログラム・予測プログラムに前処理したデータを入力して実行し、結果を得る
   - C:実行結果を分析する
     - プログラムの実行結果を数値指標やグラフを用いて分析する
   - A:次のアクションを判断する
     - 得られた結果をもとに作成した学習プログラム・予測プログラムが導入対象の業務に対して実用的であるか検討し、どの部分が問題かを明らかにする。
     - 問題を改善するためにはどうしたら良いか、また仮説を立てるところに戻る。
       例）データ量を増やすと制度が向上するのでは
       学習データの偏りを前処理で取り除くと精度が向上するのでは
       機械学習モデルを変更すると精度が向上するのでは
       プログラムのパラメータを変更すると精度が向上するのでは

4. ## PDCA サイクルはいつ終わるのか

   - 「十分に実用的である」と判断された時か、「どのように頑張っても改善できない」と判断された場合に終了する。

5. ## 機械学習プロジェクトの全体像

   1. ### 事前検証フェーズ（PoC)
      - 目的
        ・PDCA サイクルによって「機械学習を対象の業務に役立てることができるのか」を確認する
      - 成果物
        ・成果を得られるかどうかの結論
        ・機械学習プログラムの簡易実装
        ・プログラムの実行結果
        ・現状のプログラムの課題
   2. ### システム開発フェーズ
      - 目的
        ・機械学習を用いたシステムを開発する
      - 成果物
        ・完成したシステム
        ・テスト結果
        ・設計書などのドキュメント
   3. ### 保守フェーズ
      - 目的
        ・システムを安定運用する
        ・機械学習によって期待通りの成果をあげている状態を維持する
      - 作業内容
        ・日々のサーバー監視
        ・AB テストなどで機械学習の成果が出ていることを確認
        ・機械学習のパラメータの調整や、プログラム修正によるチューニング

   ![機械学習プロジェクト全体像.png](quiver-image-url/61BA2D6650EE166BFF4B5D291BCDFD0D.png =567x248)

# 3. 事前検証フェーズについて深掘り

1. ### 事前検証フェーズの目的

   - 機械学習が対象の業務に対して成果を上げられるかを確認する
   - 業務の現場から得られるデータを使用して機械学習を実行し、業務を自動化したり、未知の情報を予測して業務に役立てることができるかどうかを確認する
   - 仮説を立て、プログラムを開発し、実際にデータを入力した結果の制度を確認することを繰り返す

2. ### 事前検証フェーズの作業前に確認すること

   - #### 前提条件の確認

     1. 事前検証フェーズの期間
     2. この検証で明らかにしたいこと
     3. 学習データとして利用できそうなデータとして何があるのか
     4. データ量は何件あるのか
     5. 適用できそうなアルゴリズム
     6. データサイエンティストから得た指示やアドバイス

   - #### 成果物の確認
     1. 制度の評価方法
     2. どのようなレポートが必要か
     3. 検証用プログラムの動作環境

3. ### 事前検証フェーズでプログラマーに必要となる心がけ

   1. プログラムを作ることが最終目的ではない
      - 事前検証フェーズの目的は業務に機械学習を導入して成果をあげられるかを確認すること。
      - 必要以上に早いプログラムを書く必要はなく、不具合があっても検証に問題がないのであれば無視して進める（後の課題としてリストアップしておく）。
   2. 限られた期間で試行錯誤を多くする
      - 期間があらかじめ定められているため試行錯誤を繰り返すこと。
      - 計算の待ち時間も有効活用する
   3. 結果を早めに報告する
      - 実行結果や検証でわかったことは早い段階でグラフ等で見える化し共有する
      - 精度が高くなるまで一人で頑張ってしまうことがあるが、「高い精度が出ないとわかる」ことも成果の一つ。
      - 結果をチームで共有することで次の一手を決めやすくなる。

4. ### プログラム開発から実行までの手順

   - 成果物

     - 学習プログラムと予測プログラムの実装
     - 機械学習を適用する入力データ一式
     - 入力データを前処理するプログラム
     - 実行結果データ一式

   - 検証の手順
     1. 学習プログラムに入力するデータを取得し、前処理する
     2. 学習プログラムと予測プログラムを作成する
     3. 精度検証用にデータを分割する
     4. プログラムを実行する

   1. ### 学習プログラムに入力するデータを取得し、前処理する

      - 最も時間の見積もりが難しい作業

      1. #### データの取得方法の確認
         - 作業を始める前に受け取ったデータがどのように取得されたのか確認（通常業務で作成されたデータを使うことが望ましい。取得方法に一貫性がなかったり、データに偏りがあると正しい検証結果を得られない）
      2. #### データの読み込み
         - csv,excel,db ダンプデータなどを pandas で読めるように整形する。
         - db ダンプデータの場合は DB を構築しデータをインポートの上、SQL を実行する必要がある。
      3. #### データの前処理

         - データが正しく読み込めたら以下のような前処理をおこなう
           1. 欠損値の変換や除去
           2. 外れ値の除外
           3. 機械学習用にデータを変換

         1. #### 欠損値の変換や除去
            - 何らかの理由で値がない、不正な値であるデータを調整する（平均値で埋めたり、取り除く）。
            - pandas.DataFrame.fillna,sklearn.preprocessing.Imputer を活用
         2. #### 外れ値の除外
            - 極端に飛び出たデータがを除外する（身長、体重を逆に書いている等）
         3. #### 機械学習用にデータを変換
            1. ラベル化
               - 「会社員」「自営業」「学生」のようにグループ分けされているデータを 0,1,2 のような数値に分類する。
               - scikit-learn の labelEncoder を活用
            2. one-hot エンコーディング
               - ラベル化で 0,1,2 とラベル付けすると大小関係の処理をするリスクがある。
               - [1,0,0],[0,1,0],[0,0,1]のように変換する
               - scikit-learn の OneHotEncoder を活用
            3. ベクトル化
               - 文章を何らかの方法で数字の列に変換すること。
               - 文章の類似性などを元に学習させたい場合に文章をベクトル化する

   2. ### 学習プログラムと予測プログラムを作成する

      - 利用可能のデータの作成が終わったら、学習プログラムと予測プログラムを作成。
      - プログラマーが機械学習モデルを実装することはほとんどなく、sckit-learn,tensorflow などのライブラリによって実装済みのコードを利用する

      ```python
      #学習プログラム
      #X: 前処理済みの学習データセット
      #Y: 各学習データに対する結果ベクトル

      from sklearn.linear_model import LogisticRegression
      clf = LogisticRegression() # clfはclassifier の略、分類機の意味
      clf.fir(X,Y)
      ```

      ```python
      #予測プログラム
      #clf: 学習済みモデル

      y_pred = clf.predict(X)
      ```

   3. ### 精度検証用にデータを分割する

      - 上２つで検証に使う最小のプログラムが完成する。
      - 機械学習は入力値に対する出力が学習データによって異なるため、結果を判断しづらいため、精度検証という手法でプログラムが正常に動いているか確認する
      - 精度検証

        - 答えがわかっているデータに対して答えを渡さずにどれくらい正確に予測できているか確認する手法
        - 制度を検証するときは、前処理によって作成した利用可能データを比率を調整しながらランダムに分割する。
        - 分割した一方を学習データ、もう一方をテストデータとする。
        - scikit-learn の train_test_split() 関数を活用する

        ```python
        #X:利用可能データセット
        #y:データに対する答え

        #X_train:精度検証の学習データ
        #X_test:精度検証のテストデータ
        #y_train:精度検証の学習データの答え
        #y_test:精度検証のテストデータの答え

        from sklearn.model_selection import train_test_split

        #学習データ７０％、テストデータ３０％になるよう分割
        X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0,3, random_state=0)
        ```

        ![精度検証データの流れ-1.png](quiver-image-url/B990E4E8EF327478CCF774E3B1632C12.png =434x496)

   4. ### 結果を分析する

      - 実行結果の精度を元に、仮説が正しかったかを確認する。精度は高いほうが望ましいが１００％ということはありえず、「何％正解すれば良い」という決まりもない。
      - 評価方法をどうするか、また精度の計算方法を知ることが大切
      - 成果物
        - 検証結果
          - 結論：「〇〇という仮説に基づいて検証した結果、正しい｜間違いが示された」
          - 理由：調査結果からわかることを説明
          - グラフ：説明に必要な情報を示すもの
          - 具体的な数値（確かに調査したという証跡）
      - 結果データの分析方法
        1. 正解率（accuracy)
        2. 適合率（precision)
        3. 再現率 (recall)
        4. F 値 (f measure)

      ![accuracyとか.png](quiver-image-url/BD9886908B9F925A79D2D634FFEC6828.png =567x362)
      ![F値-2.png](quiver-image-url/B519C850AF26ABC037F14700832C70FF.png =567x243)

      ### 結果が何をもたらすか考える

      - 次の２つはどちらが許容できるか

        - 本当にガンなのに見逃す
        - ガンではないのにガンと判定される

      - ここではガンを見逃してはダメなので、再現率を高くする必要がある。
      - どの指標で何％以上の精度が望ましいかは業務の熟練者や経営者にしかわからない。良いレポートを作成するためにはステークホルダーの思いを理解しておく必要がある。
